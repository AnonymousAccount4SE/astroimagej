plugins {
    id 'java'        
    id 'application'
}

dependencies {
    implementation project(':Nom Fits Module')
}

mainClassName = 'ij.ImageJ'

processResources {
    inputs.property "version", project.version

    filesMatching("aij_version.txt") {
        expand "version": project.version
    }
}

jar {
    FileTree m = fileTree("${rootProject.projectDir}/src/main/resources/plugins/")
    Collection n = m.include("**/*.jar").grep()

    manifest {
        attributes("Main-Class": mainClassName)
        attributes("Class-Path": "plugins/ ${n.collect {'plugins/' + ((File)it).getName()}.join(' ')}")
    }

    // Ship nom.tam.fits
    from {
        duplicatesStrategy = DuplicatesStrategy.EXCLUDE
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}